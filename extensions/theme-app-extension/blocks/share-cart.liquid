{% comment %}
  KiScience Share Cart
  Allows affiliates to share customer carts with referral links
  Auto-enabled in app embeds - no manual configuration needed
{% endcomment %}

<div id="kiscience-share-cart-container">
  <!-- Share Cart UI will be injected here -->
</div>

<script id="kiscience-share-cart-config" type="application/json">
{
  "shop": "{{ shop.permanent_domain }}",
  "appApiBaseUrl": "https://rooms-autos-aware-anyone.trycloudflare.com",
  "cartId": {% if cart.id %}"{{ cart.id }}"{% else %}null{% endif %},
  "customerId": {% if customer %}"{{ customer.id }}"{% else %}null{% endif %},
  "customerEmail": {% if customer %}"{{ customer.email }}"{% else %}null{% endif %},
  "cartTotal": {{ cart.total_price | times: 0.01 | round: 2 }},
  "currency": "{{ cart.currency.iso_code | default: shop.currency }}",
  "cartItems": [
    {%- for item in cart.items -%}
    {
      "id": {{ item.id }},
      "title": "{{ item.title | escape }}",
      "price": {{ item.price | times: 0.01 | round: 2 }},
      "quantity": {{ item.quantity }},
      "url": "{{ item.url }}"
    }
    {%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  ]
}
</script>

<link rel="stylesheet" href="{{ 'share-cart-styles.css' | asset_url }}">
<script src="{{ 'share-cart-app.js' | asset_url }}"></script>

{% schema %}
  {
    "name": "KiScience Share Cart",
    "target": "section",
    "javascript": "share-cart-app.js",
    "stylesheet": "share-cart-styles.css",
    "settings": [
      {
        "type": "checkbox",
        "id": "enabled",
        "label": "Enable Share Cart",
        "default": true,
        "info": "Allow affiliates to share customer carts with referral links"
      }
    ]
  }
{% endschema %}
  
