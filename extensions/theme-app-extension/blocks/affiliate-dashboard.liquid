<!-- Extract customer data from Shopify and store in localStorage -->
<script>
  (function() {
    const customerEmail = window.Shopify?.checkout?.email;
    const customerId = window.Shopify?.checkout?.customer?.id;
    if (customerEmail) {
      localStorage.setItem('customerEmail', customerEmail);
    }
    if (customerId) {
      localStorage.setItem('customerId', customerId);
    }
    if (!customerEmail && !customerId) {
      console.warn('‚ö†Ô∏è No customer data found in Shopify checkout object');
    }
  })();
</script>

<div id="dashboard-error" class="ks-error-state" style="display: none;">
  <div class="ks-error-state__card">
    <div class="ks-error-state__icon" aria-hidden="true">
      <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
      </svg>
    </div>
    <h2 class="ks-error-state__title">Access Denied</h2>
    <p id="error-message" class="ks-error-state__message"> You don't have access to this dashboard. Please ensure you're logged in with the correct email address. </p>
    <a href="/account" class="ks-error-state__btn ks-btn">Back to Login Page</a>
  </div>
</div>

<!-- Full page skeleton shown while dashboard initializes -->
<div id="dashboard-skeleton">
  <div class="ks-skeleton-row">
    <div class="ks-skeleton-block ks-skeleton-title"></div>
    <div class="ks-skeleton-block ks-skeleton-subtitle"></div>
  </div>
  <div class="ks-skeleton-row">
    <div class="ks-skeleton-block ks-skeleton-card"></div>
    <div style="flex:1">
      <div class="ks-skeleton-row">
        <div class="ks-skeleton-block ks-skeleton-col-3"></div>
        <div class="ks-skeleton-block ks-skeleton-col-3"></div>
        <div class="ks-skeleton-block ks-skeleton-col-3"></div>
      </div>
      <div class="ks-skeleton-row" style="margin-top:12px;">
        <div class="ks-skeleton-block ks-skeleton-col-2"></div>
        <div class="ks-skeleton-block ks-skeleton-col-2"></div>
      </div>
    </div>
  </div>
</div>

<div class="ks-dashboard" id="dashboard-container" style="display: none;" data-invoice-logo-url="{{ 'ki_logo.png' | asset_url }}" data-invoice-company-name="Ki Science Limited" data-invoice-company-address="14 Hunns Mere Way, Brighton, BN2 6AH. UK." data-invoice-vat="GB 273 0155 27" data-invoice-terms-url="https://www.kiscience.com/website-terms-conditions/">
  <aside class="ks-sidebar">
    <div class="ks-sidebar__profile">
      <h3 class="ks-sidebar__name" id="ks-sidebar-name">‚Äî</h3>
      <p class="ks-sidebar__email" id="ks-sidebar-email">‚Äî</p>
      {% if customer %}
        {% assign customer_tags_downcase = customer.tags | downcase %}
        {% if customer_tags_downcase contains 'practitioner' %}
          <span class="ks-sidebar__badge">Practitioner</span>
        {% endif %}
      {% endif %}
    </div>
    <nav class="ks-tabs" role="tablist" aria-label="Dashboard sections">
      <button type="button" class="ks-tab active" data-tab="dashboard"><span class="ks-tab__icon"></span><span class="ks-tab__label">Dashboard</span></button>
      <button type="button" class="ks-tab" data-tab="orders"><span class="ks-tab__icon"></span><span class="ks-tab__label">Orders</span></button>
      <button type="button" class="ks-tab" data-tab="addresses"><span class="ks-tab__icon"></span><span class="ks-tab__label">Addresses</span></button>
      <button type="button" class="ks-tab" data-tab="account"><span class="ks-tab__icon"></span><span class="ks-tab__label">Account details</span></button>
      <button type="button" class="ks-tab" data-tab="wishlist"><span class="ks-tab__icon"></span><span class="ks-tab__label">Wish list</span></button>
      <a href="/pages/affiliate-area" class="ks-tab"><span class="ks-tab__icon"></span><span class="ks-tab__label">Affiliate Area</span></a>
    </nav>
    <div class="ks-sidebar__footer">
      <p class="ks-sidebar__brand">Ki Science</p>
      <p class="ks-sidebar__contact">Phone: <strong>+44 (0) 1273 911789</strong></p>
      <p class="ks-sidebar__contact">Email: info@kiscience.com</p>
      <a href="/account/logout" class="ks-sidebar__logout">Log out</a>
    </div>
  </aside>

  <div class="ks-dashboard-main">
  <!-- DASHBOARD TAB -->
  <section class="ks-tab-content active" id="dashboard">
    <div class="ks-dashboard-tab">
      <div class="ks-dashboard-welcome">
        <h3 class="ks-dashboard-welcome__title" style="color: #ffffff;">Dashboard</h3>
        <p class="ks-dashboard-welcome__text" style="color: #ffffff;">
          From your account dashboard you can view your recent orders, manage your
          shipping and billing addresses, and edit your password and account details.
        </p>
      </div>

      <div class="ks-stats" id="ks-stats" aria-label="Account statistics"></div>

      <div class="ks-dashboard-section ks-dashboard-section--orders">
        <h4 class="ks-dashboard-subtitle">
          <span class="ks-dashboard-subtitle__icon">üì¶</span>
          Recent orders
        </h4>
          <div class="ks-orders-list ks-orders-list--recent" id="recent-orders">
            <div class="ks-loader" aria-hidden="true"></div>
          </div>
        <a href="#" class="ks-dashboard-cta" onclick="event.preventDefault(); document.querySelector('[data-tab=orders]').click();">
          See all orders
          <span class="ks-dashboard-cta__arrow">‚Üí</span>
        </a>
      </div>

      <div class="ks-dashboard-section ks-dashboard-section--shortcuts">
        <h4 class="ks-dashboard-subtitle">
          <span class="ks-dashboard-subtitle__icon">‚ö°</span>
          Quick links
        </h4>
        <div class="ks-shortcuts ks-shortcuts--colorful">
          <a href="https://kiscience.myshopify.com/blogs/information-and-news" class="ks-shortcut">
            <span class="ks-shortcut__icon">üì∞</span>
            <span class="ks-shortcut__label">News</span>
          </a>
          <a href="/pages/contact" class="ks-shortcut">
            <span class="ks-shortcut__icon">üí¨</span>
            <span class="ks-shortcut__label">Customer support</span>
          </a>
          <a href="#" class="ks-shortcut" onclick="event.preventDefault(); document.querySelector('.ks-tab[data-tab=account]').click();">
            <span class="ks-shortcut__icon">üë§</span>
            <span class="ks-shortcut__label">Update your details</span>
          </a>
          <a href="/blogs/practitioner-information" class="ks-shortcut">
            <span class="ks-shortcut__icon">üìã</span>
            <span class="ks-shortcut__label">Products Information</span>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- ORDERS TAB -->
  <section class="ks-tab-content" id="orders">
    <div class="ks-orders-header">
      <h3 class="ks-section-title">Orders</h3>
      <p class="ks-orders-desc">View all your order history and track current orders.</p>
    </div>
    <div class="ks-orders-list" id="all-orders">
      <div class="ks-orders-loading" aria-label="Loading orders">
        <div class="ks-loader" aria-hidden="true"></div>
      </div>
    </div>
    <div class="ks-orders-pagination" id="orders-pagination" aria-label="Orders pagination"></div>
  </section>

  <!-- ADDRESSES TAB -->
  <section class="ks-tab-content" id="addresses">
    <h3 class="ks-section-title">Addresses</h3>
    <p class="ks-addresses-intro">Shipping addresses (left) are saved to your Shopify account and used at checkout. Billing addresses (right) are stored separately here‚Äîedit one without affecting the other.</p>
    <div id="addresses-list"> <div class="ks-loader" aria-hidden="true"></div></div>
  </section>

  <!-- PAYMENTS TAB -->
  <section class="ks-tab-content" id="payments">
    <h3 class="ks-section-title">Payment Methods</h3>
    <p>Manage your saved payment methods.</p>
    <div id="payment-methods">
      <div class="ks-loader" aria-hidden="true"></div>
    </div>
  </section>
  <!-- ACCOUNT TAB -->
  <section class="ks-tab-content" id="account">
    <div class="ks-account-header">
      <h3 class="ks-account-title">Account Details</h3>
      <p class="ks-account-desc">Manage your account details and preferences.</p>
    </div>
    <div id="account-details"> <div class="ks-loader" aria-hidden="true"></div></div>
  </section>

  <!-- WISHLIST TAB -->
  <section class="ks-tab-content" id="wishlist">
    <h3 class="ks-section-title">Wish list</h3>
    <p>Items you've saved for later.</p>
    <div id="wishlist-grid"><div class="ks-loader" aria-hidden="true"></div></div>
  </section>
  <!-- AFFILIATE TAB -->
  <section class="ks-tab-content" id="affiliate">
    <div class="ks-affiliate-header">
      <h3 class="ks-section-title">Affiliate Dashboard</h3>
      <p class="ks-affiliate-desc">Manage your affiliate program, track referrals, and monitor earnings.</p>
    </div>
    <div class="ks-affiliate-profile-section">
      <h4 class="ks-subtitle">Your Profile</h4>
      <div id="affiliate-profile"><div class="ks-loader" aria-hidden="true"></div></div>
    </div>
    <div class="ks-affiliate-links-section">
      <h4 class="ks-subtitle">Your Referral Links</h4>
      <div id="referral-links"> <div class="ks-loader" aria-hidden="true"></div> </div>
    </div>
    <div class="ks-affiliate-metrics-section">
      <h4 class="ks-subtitle">Earnings Overview</h4>
      <div id="earnings-metrics"> <div class="ks-loader" aria-hidden="true"></div> </div>
    </div>
    <div class="ks-affiliate-analytics-section">
      <h4 class="ks-subtitle">Performance Analytics</h4>
      <div id="analytics"> <div class="ks-loader" aria-hidden="true"></div> </div>
    </div>
  </section>
  </div>
</div>

{% schema %}
  {
    "name": "Affiliate Dashboard",
    "target": "section",
    "javascript": "affiliate-dashboard.js",
    "stylesheet": "customer-dashboard.css",
    "settings": []
  }
  {% endschema %}
  